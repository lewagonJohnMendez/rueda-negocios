<!DOCTYPE html>
<html lang="es" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Datos Ruedas de Negocios</title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Estilos base + tema oscuro (desactivado por defecto) -->
  <link rel="stylesheet" href="assets/css/app.css" />
  <link rel="stylesheet" href="assets/css/dark.css" id="dark-theme" disabled />
</head>
<body>
  <div class="container my-4">
    <header class="border-bottom pb-3 mb-3 d-flex justify-content-between align-items-center">
      <div>
        <h1 class="h3 mb-1">Rueda de Negocios</h1>
        <p class="text-muted mb-0">Captura contactos y env√≠alos directo a WhatsApp</p>
      </div>
      <button id="theme-toggle" class="btn btn-outline-secondary btn-sm">üåû Claro</button>
    </header>

    <!-- Tabs -->
    <nav class="tabs d-flex flex-wrap gap-2 mb-3" role="tablist" aria-label="Captura">
      <button class="tab active btn btn-light btn-sm" data-tab="manual" role="tab" aria-selected="true">Ingreso Manual</button>
      <button class="tab btn btn-light btn-sm" data-tab="qr" role="tab" aria-selected="false">Escanear QR</button>
      <button class="tab btn btn-light btn-sm" data-tab="card" role="tab" aria-selected="false">Foto de Tarjeta</button>
      <button class="tab btn btn-light btn-sm" data-tab="audio" role="tab" aria-selected="false">Dictado por Voz</button>
    </nav>

    <!-- TAB: Manual -->
    <section id="manual-tab" class="tab-content active p-3" role="tabpanel">
      <form id="contact-form" class="row g-3" novalidate autocomplete="off">
        <div class="col-12">
          <label for="name" class="form-label">Nombre</label>
          <input id="name" type="text" class="form-control" />
        </div>

        <div class="col-md-6">
          <label for="company" class="form-label">Empresa</label>
          <input id="company" type="text" class="form-control" />
        </div>

        <div class="col-md-6">
          <label for="position" class="form-label">Cargo</label>
          <input id="position" type="text" class="form-control" />
        </div>

        <div class="col-md-6">
          <label for="phone" class="form-label">Tel√©fono</label>
          <input id="phone" type="tel" class="form-control" />
        </div>

        <div class="col-md-6">
          <label for="email" class="form-label">Email</label>
          <input id="email" type="email" class="form-control" />
        </div>

        <div class="col-12">
          <label for="notes" class="form-label">Notas</label>
          <textarea id="notes" class="form-control" rows="4"></textarea>
        </div>

        <div class="col-12">
          <button type="button" id="save-contact" class="btn btn-primary">Guardar Contacto</button>
        </div>
      </form>
    </section>

    <!-- ========== TAB: Escanear QR ========== -->

    <section id="qr-tab" class="tab-content p-3" role="tabpanel" aria-labelledby="tab-qr">
    
    <!-- Contenedor video + overlay -->
    <div id="qr-wrap" class="qr-wrap">
        <!-- Video en vivo -->
        <video id="camera-preview" autoplay playsinline muted></video>

        <!-- Overlay alineado exactamente al √°rea visible -->
        <div class="qr-overlay" aria-hidden="true">
        <div class="qr-box"></div>
        </div>
    </div>

    <!-- Controles de escaneo -->
    <div class="d-flex align-items-center gap-2 flex-wrap mt-3">
            <button id="qr-start" type="button" class="btn btn-success btn-sm">Iniciar escaneo</button>
            <button id="qr-stop" type="button" class="btn btn-outline-secondary btn-sm" disabled>Detener</button>
            <span id="qr-status" class="text-muted small">
                Listo para escanear. Pulsa ‚ÄúIniciar escaneo‚Äù.
            </span>
        </div>

        <!-- Resultado escaneo -->
        <div id="scan-result" class="text-muted small mt-2"></div>

        <!-- Fallback: subir imagen con QR -->
        <div class="mt-4">
            <label for="qr-file" class="form-label">
            ¬øNo te deja usar la c√°mara? Sube una imagen con QR:
            </label>
            <input id="qr-file" type="file" accept="image/*" class="form-control form-control-sm" />
        </div>

    </section>
<!-- /TAB: Escanear QR -->


    <!-- TAB: Foto de Tarjeta (OCR) -->
    <section id="card-tab" class="tab-content p-3" role="tabpanel">
      <div class="mb-3">
        <label for="card-option" class="form-label">Selecciona una opci√≥n</label>
        <select id="card-option" class="form-select w-auto">
          <option value="camera">Usar la c√°mara</option>
          <option value="upload">Subir imagen</option>
        </select>
      </div>

      <div id="camera-section" hidden>
        <div class="camera-container mb-2">
          <video id="camera-preview" class="w-100 rounded border" autoplay playsinline></video>
        </div>
        <button id="capture-btn" type="button" class="btn btn-outline-primary">Capturar Foto</button>
      </div>

      <div id="upload-section" hidden>
        <input id="card-upload" type="file" accept="image/*" class="form-control mb-2" />
        <div class="camera-container">
          <img id="image-preview" alt="Vista previa" class="img-fluid rounded border" hidden />
        </div>
      </div>

      <div id="ocr-loading" class="ocr-loading d-flex align-items-center gap-2 mt-3" hidden>
        <div class="spinner border rounded-circle" style="width:28px;height:28px;"></div>
        <p class="mb-0">Procesando‚Ä¶</p>
      </div>

      <div id="ocr-result" class="ocr-result card mt-3" hidden>
        <div class="card-body">
          <h4 class="h6 mb-2">Texto detectado</h4>
          <pre id="detected-text" class="mb-0"></pre>
        </div>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button id="process-card" type="button" class="btn btn-primary" hidden>Procesar Tarjeta</button>
        <button id="save-from-card" type="button" class="btn btn-outline-success" hidden>Guardar Informaci√≥n</button>
      </div>
    </section>

    <!-- TAB: Audio -->
    <section id="audio-tab" class="tab-content p-3" role="tabpanel">
      <div class="mb-3">
        <label for="voice-notes" class="form-label">Notas por voz</label>
        <textarea id="voice-notes" class="form-control" placeholder="Haz clic y comienza a hablar‚Ä¶" rows="3" readonly></textarea>
      </div>
      <div class="d-flex gap-2">
        <button id="start-recording" type="button" class="btn btn-outline-primary">Comenzar a Grabar</button>
        <button id="stop-recording" type="button" class="btn btn-outline-secondary" disabled>Detener</button>
        <button id="save-voice-notes" type="button" class="btn btn-success" disabled>Guardar Notas</button>
      </div>
    </section>

    <!-- Preview -->
    <div class="contact-preview card mt-3">
      <div class="card-header"><strong>Contacto actual</strong></div>
      <div class="card-body">
        <div id="contact-preview-content" class="text-muted">No hay informaci√≥n capturada a√∫n</div>
      </div>
    </div>
    <!-- Boton limpiar -->
    <div class="preview-actions">
        <button id="global-clear" type="button" class="btn-clean">Limpiar</button>
    </div>
    <!-- WhatsApp -->
    <a href="#" class="btn btn-success btn-lg w-100 mt-3" id="send-whatsapp" rel="noopener">
      Enviar por WhatsApp
    </a>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Tu app modular -->
  <script type="module" src="assets/js/main.js"></script>

  <!-- Toggle de tema -->
  <script type="module" src="assets/js/theme-toggle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>
</body>
</html>
